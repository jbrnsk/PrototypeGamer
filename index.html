<!DOCTYPE html>
<html>
  <head>
    <!-- stylesheet -->
    <link href="css/literallycanvas.css" rel="stylesheet">

    <!-- dependency: React.js -->
    <script src="http://cdnjs.cloudflare.com/ajax/libs/react/0.13.3/react-with-addons.js"></script>

    <!-- Literally Canvas -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script src="js/app.js"></script>
    <script src="js/literallycanvas.js"></script>

  </head>
  <body>
    <!-- where the widget goes. you can do CSS to it. -->
    <div class="literally"></div>
    <form class="imgur-submit">
        <input type="text" name = "cardName" placeholder = "Enter card name here"/>
        <input type="submit" data-action="upload-to-imgur" value="Save Current Card to Project">
        <p class="message"></p>
    </form>
    <a href="data:application/xml;charset=utf-8,your code here" download="TS_Save_1.json">Save Deck</a>
    <a class="sprite-maker" href="#">Make Sprite</a>
    <ul class="card-list"></ul>

    <canvas id = "sprite"></canvas>

    <!-- kick it off -->
    <script>
      $(document).ready(function(){
        var url;
        var uploaded = false;
        var cardName;
        var i = 1;


        var lc = LC.init(
            document.getElementsByClassName('literally')[0],
            {imageURLPrefix: 'img'}
        );


        /* or if you just love jQuery,
            $('.literally').literallycanvas({imageURLPrefix: 'img'})
        */

         //$('button').click(function(e){
            //  e.preventDefault();
             //
            //alert("clicked!");
            //  var url = $(this).data('img-url');
            //  var name = $(this).html();
            //  var newImage = new Image();
            //  newImage.src = url;
            //  lc.saveShape(LC.createShape('Image', {x: 10, y: 10, image: newImage}));
            //  $(".cardName").val(name);
         //});

         $('.sprite-maker').click(function(){
           event.preventDefault();
           makeSprite(myCards.cards);
         });


        $('[data-action=upload-to-imgur]').click(function(e) {
            e.preventDefault();
            cardName = $('input[name="cardName"]').val();

            if(cardName && typeof myCards.cards[cardName] === 'undefined'){
              $('.message').html('Uploading...');
              // this is all standard Imgur API; only LC-specific thing is the image
              // data argument;

              $.ajax({
                url: 'https://api.imgur.com/3/image',
                type: 'POST',
                headers: {
                  // Your application gets an imgurClientId from Imgur
                  Authorization: 'Client-ID ' + 'a804111608f1744',
                  Accept: 'application/json'
                },
                data: {
                  // convert the image data to base64
                  image:  lc.canvasForExport().toDataURL().split(',')[1],
                  type: 'base64'
                },
                success: function(result) {
                  url = 'https://i.imgur.com/' + result.data.id +'.png';
                  $('.message').html("<a href='" + url + "'>" + url + "</a>");

                  //TTS_Test = createdJSON();
                  // TTS_Test.ObjectStates[0].CustomDeck[cardName] = {
                  //                                           "FaceURL": url,
                  //                                           "BackURL": url,
                  //                                           "NumWidth": 10,
                  //                                           "NumHeight": 7
                  //                                         };

                  myCards.cards[cardName] =  { FaceURL: url};

                  console.log(myCards.cards);

                  i++;

                  //createdJSON(TTS_Test);
                  //console.log(TTS_Test.ObjectStates[0].CustomDeck);

                  $('.card-list').append('<li><button data-img-url="'+ url +'">'+ cardName + '</button></li>');
                  $('input[name="cardName"]').val('');
                  addCard();

                  //$('a[download]').attr("href", "data:application/" + TTS_SaveFile);
                  //makeSprite(TTS_Test.ObjectStates[0].CustomDeck);

                },
              });
            } else if (cardName){
                alert("There is already a card by this name. Overwrite previous version?");
            } else {
              alert("Enter Card Name");
            }

          });
        });
    </script>

  </body>
</html>
