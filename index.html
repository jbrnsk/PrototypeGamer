<!DOCTYPE html>
<html>
  <head>
    <!-- stylesheet -->
    <link href="css/literallycanvas.css" rel="stylesheet">

    <!-- dependency: React.js -->
    <script src="http://cdnjs.cloudflare.com/ajax/libs/react/0.13.3/react-with-addons.js"></script>

    <!-- Literally Canvas -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script src="js/app.js"></script>
    <script src="js/literallycanvas.js"></script>
    <!-- JS PDF Library -->
    <script src="https://parall.ax/parallax/js/jspdf.js"></script>

  </head>
    <div class = "message"></div>
    <div class = containsAll>
         <div class = "cardNamer">
            <form class="imgur-submit">
                <input type="text" name = "cardName" placeholder = "Enter card name here"/>
                <input type="submit" data-action="upload-to-imgur" value="Save Current Card to Project">
            </form>
        </div>

        <!-- where the widget goes. you can do CSS to it. -->
        <div class="literally"></div>
        <div class="card-list-container"><ul class="card-list"></ul></div>
        <div class = "cardNamer">
           <div class ="deckButtons">
                <button class="ttsButton">Download For Tabletop Simulator</button>
                <a class="sprite-maker" href="#">Save Deck as TTS Save File</a>
                <a id = "downloadHiddenButton" href="data:application/xml;charset=utf-8,your code here" download="TS_Save_1.json">Save Deck</a>
                <button class="downloadAsPDF">Download As PDF</button>
            </div>
        </div>

        <canvas id = "sprite"></canvas>
        <input id = "customFileUpload" type="file" onchange="previewFile()"><br>
        <img src="" height="00" alt="Image preview...">
     </div>
    <!-- kick it off -->
    <script>
        
      $(document).ready(function(){
        var url;
        var uploaded = false;
        var cardName;
        var i = 1;


        var lc = LC.init(
            document.getElementsByClassName('literally')[0],
            {imageURLPrefix: 'img'}
        );

         $('.sprite-maker').click(function(){ 
           event.preventDefault();
           makeSprite(myCards.cards);
         });
          
          $('.downloadAsPDF').click(function(){
           event.preventDefault();
           downloadPDF(); 
         });
          
           $('.ttsButton').click(function(){
           event.preventDefault();
           ttsClicked(); 
         });
          
        $('[data-action=upload-to-imgur]').click(function(e) {
            e.preventDefault();
            cardName = $('input[name="cardName"]').val();

            if(cardName && typeof myCards.cards[cardName] === 'undefined'){
              $('.message').html('Uploading...');
              // this is all standard Imgur API; only LC-specific thing is the image
              // data argument;

              $.ajax({
                url: 'https://api.imgur.com/3/image',
                type: 'POST',
                headers: {
                  // Your application gets an imgurClientId from Imgur
                  Authorization: 'Client-ID a804111608f1744',
                  Accept: 'application/json'
                },
                data: {
                  // convert the image data to base64
                  image:  lc.canvasForExport().toDataURL().split(',')[1],
                  type: 'base64'
                },
                success: function(result) {
                  url = 'https://i.imgur.com/' + result.data.id +'.png';
                  $('.message').html("<a href='" + url + "' target='_blank'>" + url + "</a>");

                  myCards.cards[cardName] =  { FaceURL: url};

                  console.log(myCards.cards);

                  i++;

                  $('.card-list').append('<li><button data-img-url="'+ url +'">'+ cardName + '</button></li>');
                  $('input[name="cardName"]').val('');
                  addCard();

                },
              });
            } else if (cardName){
                alert("There is already a card by this name!");
            } else {
              alert("Enter Card Name");
            }

          });
        });
    </script>

  </body>
</html>
